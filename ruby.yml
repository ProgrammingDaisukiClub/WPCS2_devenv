- name: Get rbenv from GitHub
  git:
    repo: https://github.com/rbenv/rbenv.git
    dest: /root/.rbenv

- name: Configure rbenv
  shell: ./configure
  args:
    chdir: /root/.rbenv/src

- name: make rbenv
  shell: make -C src
  args:
    chdir: /root/.rbenv

- name: Update PATH
  lineinfile:
    state: present
    dest: /root/.bashrc
    line: 'export PATH="$HOME/.rbenv/bin:$PATH" && eval "$(rbenv init -)"'

- name: Update PATH2
  lineinfile:
    state: present
    dest: /root/.bashrc
    line: 'PATH="`ruby -e "puts Gem.user_dir"`/bin:$PATH"'

- name: Get ruby-build from GitHub
  git:
    repo: https://github.com/rbenv/ruby-build.git
    dest: /root/.rbenv/plugins/ruby-build

- name: Install libreadline-dev
  apt:
    name: libreadline-dev

- name: Check if ruby is installed
  shell: ls /root/.rbenv/versions/ | grep 2.4.0
  register: ruby_install_status
  become: yes
  become_user: root
  failed_when: ruby_install_status.rc not in [0, 1]

- name: Install ruby
  shell: /root/.rbenv/bin/rbenv install 2.4.0
  args:
    chdir: /root
  when: ruby_install_status.rc == 1

#- name: set rbenv
#  shell: /root/.rbenv/bin/rbenv global 2.4.0
#  args:
#    chdir: /root

#- gem:
#    name: rails
#    state: present
#    executable: /root/.rbenv/shims/gem


